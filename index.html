<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Photo Collage Generator</title>

<style>
:root {
  --bg: #ffffff;
  --fg: #111111;
  --card: #f2f2f2;
  --accent: #4f46e5;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0f1115;
    --fg: #e5e7eb;
    --card: #1f2933;
  }
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--fg);
}

.container {
  max-width: 900px;
  padding: 1rem;
  margin: auto;
}

h1 {
  text-align: center;
  margin-bottom: 1rem;
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 1rem;
  margin-bottom: 1rem;
}

label {
  font-size: 0.9rem;
  display: block;
  margin-top: 0.5rem;
}

input, select, button, textarea {
  width: 100%;
  padding: 0.6rem;
  margin-top: 0.3rem;
  border-radius: 10px;
  border: none;
  font-size: 1rem;
}
input[type=color]{
	padding: 0.1rem;
}

textarea { resize: vertical; }

button {
  background: var(--accent);
  color: white;
  cursor: pointer;
}

button.secondary { background: #6b7280; }
button.danger { background: #dc2626; }

.image-row {
  display: grid;
  grid-template-columns: 120px 1fr auto;
  gap: 0.5rem;
  margin-top: 0.8rem;
}

.image-row img {
  width: 120px;
  border-radius: 10px;
  object-fit: contain;
}

#infostate {
  margin-top: 1rem;
  padding: 0.6rem;
  border-radius: 10px;
  text-align: center;
}

#infostate.ok { background: #16a34a; color: white; }
#infostate.warn { background: #f59e0b; color: black; }
#infostate.error { background: #dc2626; color: white; }

@media (max-width: 600px) {
  .image-row { grid-template-columns: 1fr; }
  .image-row img { width: 100%; }
}
footer {
    text-align: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    color: #e0e0e0;
    font-size: 1em;
    margin-top: 50px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

footer a {
    color: #00dfd8;
    text-decoration: none;
    font-weight: bold;
    transition: color 0.3s ease, transform 0.2s ease;
}

footer a:hover {
    color: #007bff;
    transform: scale(1.1);
}

#dropzone {
	border: 2px dashed #6b7280;
  	border-radius: 14px;
  	padding: 1.2rem;
  	text-align: center;
  	margin-bottom: 0.8rem;
  	transition: 0.2s;
}
</style>
</head>

<body>
<div class="container">
  <h1>ðŸ“¸ Collage Generator</h1>

  <div class="card">
    <label>Title</label>
    <input id="title" placeholder="My collage" />

    <label>Add images</label>
	<div id="dropzone">Drag & drop images here</div>
    <input id="images" type="file" accept="image/*" multiple />

    <div id="descriptions"></div>
  </div>

  <div class="card">
    <label>Font</label>
    <select id="font">
      <option>Arial</option>
      <option>Georgia</option>
      <option>Courier New</option>
      <option>Verdana</option>
    </select>

    <label>Font size (px)</label>
    <input id="fontSize" type="number" min="10" max="40" />

    <label>Columns</label>
    <input id="columns" type="number" min="1" max="3" />

    <label>Background color</label>
    <input id="bgColor" type="color" />

    <label>Font color</label>
    <input id="fontColor" type="color" />

    <label>Spacing between images (px)</label>
    <input id="spacing" type="number" min="0" max="50" />
  </div>

  <div class="card">
    <button onclick="generate()">Generate</button>
    <button class="secondary" onclick="resetDefaults()">Set Default values</button>
  </div>

  <p id="infostate"></p>
  <div class="card">
  <label>Generated preview</label>
  <img id="preview" style="width:100%; border-radius:12px; display:none;" />
</div>

</div>
<footer>
<span>Created by</span> <a href="https://mjportfolio.bieda.it/" target="_blank">MiÅ‚osz 'milessic' Jura</a><span id="year">, 2026</span>
</footer>

<script>
	const defaults = {
    font: "Arial",
    fontSize: 18,
    columns: 1,
    bgColor: "#ffffff",
    fontColor: "#000000",
    spacing: 10
};
let files = [],
    descriptionsData = [];
const state = JSON.parse(localStorage.getItem("collageSettings")) || defaults;

function setInfo(e, t) {
    infostate.textContent = e, infostate.className = t
}

function renderDescriptions() {
    descriptions.innerHTML = "", files.forEach((e, t) => {
        let a = document.createElement("div");
        a.className = "image-row", a.innerHTML = `
      <img src="${URL.createObjectURL(e)}">
      <textarea placeholder="Description">${descriptionsData[t]}</textarea>
      <button class="danger">âœ•</button>
    `, a.querySelector("textarea").oninput = e => descriptionsData[t] = e.target.value, a.querySelector("button").onclick = () => {
            files.splice(t, 1), descriptionsData.splice(t, 1), renderDescriptions(), setInfo("Image removed", "warn")
        }, descriptions.appendChild(a)
    })
}

function saveSettings() {
    localStorage.setItem("collageSettings", JSON.stringify({
        font: font.value,
        fontSize: fontSize.value,
        columns: columns.value,
        bgColor: bgColor.value,
        fontColor: fontColor.value,
        spacing: spacing.value
    }))
}

function resetDefaults() {
    localStorage.removeItem("collageSettings"), location.reload()
}

function wrapText(e, t, a) {
    let l = t.split(" "),
        n = [],
        i = "";
    for (let o of l) {
        let r = i + o + " ",
            s = e.measureText(r);
        s.width > a && "" !== i ? (n.push(i.trim()), i = o + " ") : i = r
    }
    return i && n.push(i.trim()), n
}

function textBlockHeight(e, t, a = 4) {
    return e.length * (t + a)
}
async function generate() {
    if (!files.length) {
        setInfo("Please upload at least one image", "warn");
        return
    }
    saveSettings();
    let e = document.createElement("canvas"),
        t = e.getContext("2d"),
        a = await Promise.all(files.map(e => new Promise(t => {
            let a = new Image;
            a.onload = () => t(a), a.src = URL.createObjectURL(e)
        }))),
        l = Math.max(1, Math.min(3, Number(columns.value))),
        n = Number(spacing.value),
        i = Number(fontSize.value),
        o = (1200 - n * (l - 1)) / l;
    e.width = 1200, e.height = 5e3, t.fillStyle = bgColor.value, t.fillRect(0, 0, e.width, e.height), t.fillStyle = fontColor.value, t.textAlign = "center", t.textBaseline = "top", t.font = `${i}px ${font.value}`;
    let r = 0,
        s = 80,
        c = 0;
    a.forEach((e, a) => {
        let f = e.height / e.width * o,
            d = descriptionsData?.[a] || "",
            g = d ? wrapText(t, d, o - 12) : [],
            u = textBlockHeight(g, i);
        t.drawImage(e, r, s, o, f);
        let p = s + f + 6;
        g.forEach(e => {
            t.fillText(e, r + o / 2, p), p += i + 4
        }), c = Math.max(c, f + u + 12), r += o + n, (a + 1) % l == 0 && (r = 0, s += c + n, c = 0)
    }), s += c, t.font = `bold ${i+10}px ${font.value}`, t.fillText(title.value || "", e.width / 2, 20);
    let f = document.createElement("canvas");
    f.width = e.width, f.height = s + 20, f.getContext("2d").drawImage(e, 0, 0), e.width = f.width, e.height = f.height, t.drawImage(f, 0, 0);
    let d = e.toDataURL("image/png"),
        g = document.createElement("a");
	if (DOWNLOAD_COLLAGE) {g.download = "collage.png", g.href = d, g.click();}
    let u = document.getElementById("preview");
    u.src = d, u.style.display = "block", setInfo("Collage generated, downloaded and previewed", "ok")
}

function getTimestamp() {
    let e = new Date;
    return `${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`
}

function addFiles(newFiles) {
  if (!newFiles.length) return;

  if (files.length + newFiles.length > 20) {
    setInfo("You can add up to 20 images total", "error");
    return;
  }

  newFiles.forEach(file => {
    if (!file.type.startsWith("image/")) return;
    files.push(file);
    descriptionsData.push("");
  });

  renderDescriptions();
  setInfo("Images added", "ok");
}

const DOWNLOAD_COLLAGE = false;

Object.keys(defaults).forEach(e => window[e].value = state[e])


images.addEventListener("change", () => {
	/* prevent from uploading more than 20
    if ((files = [...images.files]).length > 20) {
        setInfo("Maximum 20 images allowed", "error"), files = [], images.value = "";
        return
    }
	*/
	addFiles([...images.files]);
	images.value = "";
});

// add drag and drop
const dropzone = document.getElementById("dropzone");

["dragenter", "dragover"].forEach(evt => {
  dropzone.addEventListener(evt, e => {
    e.preventDefault();
    dropzone.style.borderColor = "#4f46e5";
    dropzone.style.background = "rgba(79,70,229,0.1)";
  });
});

["dragleave", "drop"].forEach(evt => {
  dropzone.addEventListener(evt, e => {
    e.preventDefault();
    dropzone.style.borderColor = "#6b7280";
    dropzone.style.background = "transparent";
  });
});

dropzone.addEventListener("drop", e => {
  const droppedFiles = [...e.dataTransfer.files];
  addFiles(droppedFiles);
});
document.addEventListener("dragover", e => e.preventDefault());
document.addEventListener("drop", e => e.preventDefault());
title.value = getTimestamp();
</script>
</body>
</html>

